<!-- script src="https://rawgit.com/chenzlabs/aframe/support-vive-tracker-dist/dist/aframe-master.js"></script -->

<script src="https://rawgit.com/chenzlabs/aframe/master/dist/aframe-master.js"></script>
<!-- <script src="lib/aframe.js"></script> -->

    <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>

<script>
  AFRAME.registerComponent('tracker-marker', {
    schema: {type: 'string'},
    init: function () {
      // red ray forward (-Z)
      var forwardRayEl = document.createElement('a-box');
      forwardRayEl.setAttribute('width', '0.001');
      forwardRayEl.setAttribute('height', '0.001');
      forwardRayEl.setAttribute('depth', '1');
      forwardRayEl.setAttribute('position', '0 0 -0.5');
      forwardRayEl.setAttribute('color', 'red');
      // blue ray up (+Y)
      var upwardRayEl = document.createElement('a-box');
      upwardRayEl.setAttribute('width', '0.001');
      upwardRayEl.setAttribute('height', '1');
      upwardRayEl.setAttribute('depth', '0.001');
      upwardRayEl.setAttribute('position', '0 0.5 0');
      upwardRayEl.setAttribute('color', 'blue');
      // tracker model (which is currently 180 degrees rotated)
      var modelEl = document.createElement('a-entity');
      modelEl.setAttribute('obj-model', 'obj', 'https://cdn.aframe.io/controllers/vive/vr_tracker-vive.obj');
      modelEl.setAttribute('obj-model', 'mtl', 'https://cdn.aframe.io/controllers/vive/vr_tracker-vive.mtl');
      modelEl.setAttribute('rotation', '180 0 0');
      // blue label with carets forward (-Z)
      var labelEl = document.createElement('a-box');
      labelEl.setAttribute('color', 'blue');
      labelEl.setAttribute('text', 'zOffset:0.01; color:white; align:center; wrapCount:5; value:^' + this.data + '^');
      labelEl.setAttribute('width', '0.1');
      labelEl.setAttribute('height', '0.1');
      labelEl.setAttribute('depth', '0.001');
      labelEl.setAttribute('rotation', '-90 0 0');

      this.el.appendChild(forwardRayEl);
      this.el.appendChild(upwardRayEl);
      this.el.appendChild(modelEl);
      this.el.appendChild(labelEl);
    }
  })
</script>
    <script>




    AFRAME.registerComponent('firebase-tracker', {
      schema: {type: 'string'},
      init: function () {
        // make a new entry in DB to define tracker
        console.log("init");
            var config = {
      apiKey: "AIzaSyBUc9V9MlaQz6A3cs1l28Hks8Ghy7EsvOY",
      authDomain: "tracker-900d4.firebaseapp.com",
      databaseURL: "https://tracker-900d4.firebaseio.com",
      projectId: "tracker-900d4",
      storageBucket: "tracker-900d4.appspot.com",
      messagingSenderId: "577646620355"
    };
    firebase.initializeApp(config);
			//this.el.components.viveTracker
//        var fooComponent = document.querySelector('[foo]').components.foo;

      },
      tick: function () {
//        var trackerId = 0;         // ToDo: get tracker id
        var trackerId = this.el.getAttribute("vive-tracker").index;
				firebase.database().ref('tracker/' + trackerId).set({
          rotationX: this.el.object3D.rotation.x / (Math.PI / 180),
          rotationY: this.el.object3D.rotation.y / (Math.PI / 180),
          rotationZ: this.el.object3D.rotation.z / (Math.PI / 180),
          positionX: this.el.object3D.position.x,
          positionY: this.el.object3D.position.y,
          positionZ: this.el.object3D.position.z
        });
      }
    })

    </script>
<a-scene>
    <a-assets>
        <a-mixin id="cube"
                 geometry="primitive: box; height: 0.30; width: 0.30; depth: 0.30"
                 material="color: #EF2D5E;"></a-mixin>
        <a-mixin id="cube-collided"
                 material="color: #F2E646;"></a-mixin>
        <a-mixin id="cube-grabbed"
                 material="color: #F2E646;"></a-mixin>
      </a-assets>
        <!-- A-Frame cubes -->
      <a-entity position="0 0 -0.5">
        <a-entity class="cube" mixin="cube" position="0.30 1.65 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="0 1.95 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="-0.30 1.65 0"></a-entity>

        <a-entity class="cube" mixin="cube" position="0.60 1.35 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="0.60 1.05 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="0.60 0.75 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="0.60 0.45 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="0.60 0.15 0"></a-entity>

        <a-entity class="cube" mixin="cube" position="0.30 0.75 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="0 0.75 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="-0.30 0.75 0"></a-entity>

        <a-entity class="cube" mixin="cube" position="-0.60 1.35 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="-0.60 1.05 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="-0.60 0.75 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="-0.60 0.45 0"></a-entity>
        <a-entity class="cube" mixin="cube" position="-0.60 0.15 0"></a-entity>

  <a-sky color="#3CF"></a-sky>

  <!-- <a-entity position="0 0 -2">
   <a-entity tracker-marker="^"></a-entity>
  </a-entity> -->

  <!-- first tracker, with correction -->
  <a-entity position="0 0 0.5" firebase-tracker vive-tracker="index:0;model:false;rotation:90 0 0">
   <a-entity tracker-marker="0"></a-entity>
  </a-entity>

  <!-- second tracker, manual correction to match controller -->
  <a-entity vive-tracker="index:1;model:false;rotation:-90 0 0">
   <a-entity tracker-marker="1"></a-entity>
  </a-entity>

  <!-- third tracker, automated correction if any -->
  <a-entity vive-tracker="index:2;model:false">
   <a-entity tracker-marker="2"></a-entity>
  </a-entity>

  <!-- left controller -->
  <a-entity vive-controls="hand:left">
   <a-entity tracker-marker="L"></a-entity>
  </a-entity>
  <!-- use hand-controls for right, to check rotationOffset -->
  <a-entity hand-controls="right">
   <a-entity tracker-marker="R"></a-entity>
  </a-entity>
</a-scene>
